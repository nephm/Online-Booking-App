<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Badminton Court Booking</title>
    <link th:href="@{/css/styles.css}" rel="stylesheet">
    <link th:href="@{/css/court.css}" rel="stylesheet">
    <script th:src="@{/js/script.js}" defer></script>
</head>
<body>
<div class="dashboard-container">
    <header class="header">
        <nav class="nav">
            <div class="logo">CourtBooker</div>
            <div class="nav-links">
                <a th:href="@{/venues}" class="nav-link">Venues</a>
                <a th:href="@{/admin}" class="nav-link">ADMINNN</a>
                <a th:href="@{/court}" class="nav-link">COURTTT</a>
                <a th:href="@{/about}" class="nav-link">About</a>
                <a th:href="@{/contacts}" class="nav-link">Contacts</a>
                <div class="auth-buttons">
                    <a th:href="@{/login}" class="auth-btn login-btn">Login</a>
                    <a th:href="@{/register}" class="auth-btn register-btn">Register</a>
                </div>
            </nav>
        </header>

    <h1 class="venues-title" th:text="${pageTitle ?: 'Elite Badminton Center'}">Elite Badminton Center</h1>

    <!-- Edit Mode Notice -->
    <div th:if="${editMode}" class="edit-notice">
        <div class="edit-notice-content">
            <span class="edit-icon">✏️</span>
            <strong>Edit Mode:</strong> Select a new time slot for Booking #<span th:text="${editBookingId}"></span>
            <br><small>Original slot: <span th:text="${originalDate}"></span></small>
        </div>
    </div>

    <!-- Date Filter -->
    <form method="get" th:action="@{/venue/__${venue.venueId}__/courts}" class="date-filter-container">
        <label for="date" class="date-filter-label">Select Date:</label>
        <select id="date" name="date" class="date-select" onchange="this.form.submit()">
            <option th:each="day : ${#numbers.sequence(1,30)}"
                    th:value="${'2025-09-' + (day < 10 ? '0' + day : day)}"
                    th:text="${'Sep ' + day}"
                    th:selected="${selectedDate == T(java.time.LocalDate).parse('2025-09-' + (day < 10 ? '0' + day : day))}">
            </option>
        </select>
    </form>

    <!-- Legend -->
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color legend-available"></div>
            <span>Available</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-selected"></div>
            <span>Selected</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-booked"></div>
            <span>Booked</span>
        </div>
    </div>

    <!-- Booking table -->
    <form th:action="${submitAction ?: '/book'}" method="post">
        <!-- Hidden fields for edit mode -->
        <input th:if="${editMode}" type="hidden" name="editBookingId" th:value="${editBookingId}">
        <input th:if="${editMode}" type="hidden" name="originalUserId" th:value="${originalUserId}">
        
        <table id="bookingTable">
            <thead>
                <tr>
                    <th>Court</th>
                    <th th:each="slot : ${headerSlots}" th:text="${slot}"></th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="court : ${courts}">
                    <td class="court-label" th:text="${court.courtName}"></td>
    
                    <td th:each="slot : ${timeSlots}">
                        <input type="checkbox"
                            name="selectedSlots"
                            th:value="${court.courtId + '-' + slot.timeslotId + '-' + #temporals.format(selectedDate, 'yyyy-MM-dd')}"
                            th:disabled="${availability[court.courtId + '-' + slot.timeslotId]} == false" 
                            th:checked="${editMode and preSelectedSlot == (court.courtId + '-' + slot.timeslotId)}"
                            class="timeslot-block"/>
                    </td>
                </tr>
            </tbody>
        </table>
    
        <div style="margin-top: 20px; text-align: center;">
            <button type="submit" class="proceed-btn" th:text="${submitButtonText ?: 'Proceed to Book'}">Proceed to Book</button>
            <a th:if="${editMode}" th:href="@{/admin}" class="proceed-btn" style="background: #6b7280; margin-left: 10px;">Cancel</a>
        </div>
    </form>
</div>
</body>
</html>